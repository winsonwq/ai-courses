# L11 æ„å»ºå¤š Agents å·¥ä½œæµ

## 1. ä»€ä¹ˆæ˜¯å¤š Agents å·¥ä½œæµï¼Ÿ

**å¤š Agents å·¥ä½œæµ**æ˜¯åœ¨å• Agent å¾ªç¯ï¼ˆè§ L09ï¼‰ä¹‹ä¸Šçš„æ‰©å±•ï¼šç”±å¤šä¸ªåˆ†å·¥ä¸åŒçš„ Agent åä½œå®Œæˆç”¨æˆ·è¯·æ±‚ã€‚

æœ¬è¯¾é‡‡ç”¨ **Coordinator + Worker** æ¨¡å¼ï¼š

- **åè°ƒè€… (Coordinator)**ï¼šç†è§£ç”¨æˆ·æ„å›¾ï¼Œå†³å®šâ€œè°æ¥åšâ€ï¼ŒæŠŠå­ä»»åŠ¡å§”æ´¾ç»™å¯¹åº”çš„ä¸“å®¶ Agentã€‚
- **å·¥ä½œè€… (Worker)**ï¼šå„å¸å…¶èŒçš„ä¸“å®¶ Agentï¼ˆæœ¬ä»“åº“ä¸ºæ–‡ä»¶ Agentã€ç¿»è¯‘ Agentï¼‰ï¼Œå„è‡ªæ‹¥æœ‰ä¸“ç”¨å·¥å…·å’Œå•å¾ªç¯é€»è¾‘ï¼Œå®ŒæˆåæŠŠç»“æœäº¤å›åè°ƒè€…ã€‚

ç”¨æˆ·åªå’Œåè°ƒè€…å¯¹è¯ï¼›åè°ƒè€…é€šè¿‡â€œå§”æ´¾å·¥å…·â€è°ƒç”¨ Workerï¼Œå†æŠŠ Worker çš„è¿”å›æ•´ç†æˆæœ€ç»ˆå›å¤ã€‚**æ‰€æœ‰ Agentï¼ˆåè°ƒè€… + å„ Workerï¼‰å…±ç”¨åŒä¸€ä¸ªå¤§æ¨¡å‹**ï¼Œé€šè¿‡ä¸åŒçš„â€œå®šä¹‰â€åŒºåˆ†è§’è‰²ä¸èƒ½åŠ›ï¼ˆè§ä¸‹æ–‡ï¼‰ã€‚

```mermaid
graph TD
    A[ç”¨æˆ·è¾“å…¥] --> B[åè°ƒè€… Agent]
    B --> C{"éœ€è¦å§”æ´¾?"}
    C -- æ˜¯ --> D[å§”æ´¾å·¥å…·: delegateToFileAgent / delegateToTranslateAgent]
    D --> E[Worker Agent è¿è¡Œè‡ªèº«å¾ªç¯]
    E --> F[å·¥å…·è°ƒç”¨ runSafeShell / translate ç­‰]
    F --> E
    E --> G[Worker è¿”å›ç»“æœ]
    G --> B
    B --> C
    C -- å¦ --> H[æ•´ç†å›å¤å¹¶è¾“å‡º [STOP]]
    H --> I[ç»“æŸ]
```

## 2. ä¸ L09 çš„å¯¹æ¯”

| ç»´åº¦       | L09 è‡ªä¸»ä»£ç†å¾ªç¯       | L11 å¤š Agents å·¥ä½œæµ              |
|------------|------------------------|------------------------------------|
| Agent æ•°é‡ | å•ä¸ª Agent             | 1 ä¸ªåè°ƒè€… + å¤šä¸ª Worker          |
| å·¥å…·å½’å±   | æ‰€æœ‰å·¥å…·åœ¨ä¸€ä¸ª Agent   | åè°ƒè€…åªæœ‰â€œå§”æ´¾â€ï¼ŒWorker æœ‰å…·ä½“å·¥å…· |
| å¾ªç¯å±‚æ¬¡   | ä¸€å±‚å¾ªç¯               | åè°ƒè€…ä¸€å±‚ï¼Œæ¯ä¸ª Worker å„è‡ªä¸€å±‚   |
| æ¨¡å‹       | ä¸€ä¸ªæ¨¡å‹               | **åŒä¸€æ¨¡å‹**ï¼Œå¤šå¥—â€œå®šä¹‰â€ï¼ˆsystem + toolsï¼‰ |
| é€‚ç”¨åœºæ™¯   | ä»»åŠ¡ç®€å•ã€å·¥å…·å°‘       | ä»»åŠ¡å¯æ‹†è§£ã€éœ€è¦åˆ†å·¥ä¸å¤ç”¨         |

L11 çš„ä»£ç å¤ç”¨äº† L09 çš„ **å•å¾ªç¯é€»è¾‘**ï¼ˆ`runAgentLoop`ï¼‰ï¼Œé€šè¿‡ä¸åŒçš„ `tools` å’Œ `handleToolCalls` å®ç°åè°ƒè€…ä¸ Worker çš„åŒºåˆ†ï¼›**æ¯ä¸ª Agent çš„â€œèº«ä»½â€ç”± system message + å·¥å…·åˆ—è¡¨å…±åŒå†³å®š**ã€‚

## 3. æœ¬ä»“åº“å®ç°è¦ç‚¹

### 3.1 åè°ƒè€…çš„â€œå·¥å…·â€ = å§”æ´¾

åè°ƒè€…ä¸ç›´æ¥æ‰§è¡Œ Shell æˆ–è°ƒç”¨ç¿»è¯‘ APIï¼Œè€Œæ˜¯è°ƒç”¨å§”æ´¾å·¥å…·ï¼š

- `delegateToFileAgent(query)`ï¼šæŠŠè¯»/å†™æ–‡ä»¶ã€åˆ—ç›®å½•ã€æ‰§è¡Œåªè¯» Shell ç­‰è¯·æ±‚äº¤ç»™æ–‡ä»¶ Workerã€‚
- `delegateToTranslateAgent(content)`ï¼šæŠŠç¿»è¯‘ã€æ¶¦è‰²ã€æ‘˜è¦ç­‰æ–‡æœ¬å¤„ç†è¯·æ±‚äº¤ç»™ç¿»è¯‘ Workerã€‚

æ‰§è¡Œè¿™äº›â€œå·¥å…·â€æ—¶ï¼Œå®é™…æ˜¯ï¼š**å¯åŠ¨å¯¹åº” Worker çš„å®Œæ•´ Agent å¾ªç¯**ï¼ˆè¯¥ Worker ä½¿ç”¨è‡ªå·±çš„ system message + å·¥å…·å†è°ƒåŒä¸€æ¨¡å‹ï¼‰ï¼Œæ”¶é›†å…¶æœ€ç»ˆå›ç­”ï¼ˆå»æ‰ `[STOP]`ï¼‰ï¼Œä½œä¸ºè¯¥å·¥å…·è°ƒç”¨çš„è¿”å›å€¼å†™å›åè°ƒè€…çš„å¯¹è¯å†å²ã€‚

### 3.2 Worker ä»æ˜¯å•å¾ªç¯

æ¯ä¸ª Workerï¼ˆæ–‡ä»¶ã€ç¿»è¯‘ï¼‰å†…éƒ¨ä»æ˜¯ L09 å¼çš„å•å¾ªç¯ï¼š

- æ”¶åˆ°ä¸€æ¡â€œç”¨æˆ·çº§â€è¯·æ±‚ï¼ˆå³åè°ƒè€…ä¼ å…¥çš„ `query` / `content`ï¼‰ã€‚
- è‹¥æœ‰å·¥å…·è°ƒç”¨åˆ™æ‰§è¡Œï¼ˆå¦‚ `runSafeShell`ã€`translate`ï¼‰ï¼Œç»“æœå†™å›æ¶ˆæ¯ã€‚
- ç›´åˆ°æ¨¡å‹å›å¤ä¸­åŒ…å« `[STOP]`ï¼Œå¾ªç¯ç»“æŸï¼Œæœ€åä¸€æ¡åŠ©ç†æ¶ˆæ¯å†…å®¹ä½œä¸ºå§”æ´¾ç»“æœè¿”å›ç»™åè°ƒè€…ã€‚

### 3.3 æ¶ˆæ¯æµç®€è¿°

1. ç”¨æˆ· â†’ åè°ƒè€…ï¼š`"çœ‹ä¸€ä¸‹ ~/downloads é‡Œå…³äºè®¾è®¡çš„æ–‡ä»¶ï¼Œæ•´ç†åç¿»è¯‘æˆè‹±æ–‡å†™åˆ° output.md"`  
2. åè°ƒè€…è°ƒç”¨ `delegateToFileAgent("åˆ—å‡ºå¹¶ç­›é€‰â€¦")` â†’ æ–‡ä»¶ Worker è·‘å®Œ â†’ è¿”å›æ•´ç†å¥½çš„æ–‡ä»¶åˆ—è¡¨ã€‚  
3. åè°ƒè€…è°ƒç”¨ `delegateToTranslateAgent("å°†ä¸Šè¿°å†…å®¹ç¿»è¯‘æˆè‹±æ–‡")` â†’ ç¿»è¯‘ Worker è·‘å®Œ â†’ è¿”å›è‹±æ–‡å†…å®¹ã€‚  
4. åè°ƒè€…å†è°ƒç”¨ `delegateToFileAgent("å°†ä»¥ä¸‹å†…å®¹å†™å…¥ output.md")` â†’ æ–‡ä»¶ Worker å†™æ–‡ä»¶åè¿”å›ã€‚  
5. åè°ƒè€…æ ¹æ®å„æ¬¡ç»“æœç»„ç»‡å›å¤ï¼Œç»“å°¾åŠ ä¸Š `[STOP]`ï¼Œæµç¨‹ç»“æŸã€‚

## 4. æ¨¡å¼ç‰¹ç‚¹

### 4.1 å¤š Agent ä¸åŒå®šä¹‰ã€åŒä¸€æ¨¡å‹çš„æ„ä¹‰

æœ¬ä»“åº“ä¸­**åè°ƒè€…ä¸æ‰€æœ‰ Worker éƒ½è°ƒç”¨åŒä¸€ä¸ªå¤§æ¨¡å‹**ï¼ˆå¦‚ DeepSeekï¼‰ï¼Œæ²¡æœ‰ä¸ºæ¯ä¸ª Agent å•ç‹¬è®­ç»ƒæˆ–éƒ¨ç½²ä¸åŒæ¨¡å‹ã€‚â€œå¤š Agentâ€ä½“ç°åœ¨**å¤šå¥—å®šä¹‰**ä¸Šï¼š

- **ä¸åŒ system message**ï¼šåè°ƒè€…æ˜¯â€œåè°ƒè€…åŠ©æ‰‹ï¼Œè´Ÿè´£å§”æ´¾â€ï¼›æ–‡ä»¶ Agent æ˜¯â€œæœ¬åœ° Shell åŠ©æ‰‹â€ï¼›ç¿»è¯‘ Agent æ˜¯â€œç¿»è¯‘ä¸æ–‡æœ¬åŠ©æ‰‹â€ã€‚åŒä¸€æ¨¡å‹åœ¨ä¸åŒå¯¹è¯é‡Œæ‰®æ¼”ä¸åŒè§’è‰²ã€‚
- **ä¸åŒå·¥å…·é›†**ï¼šåè°ƒè€…åªæœ‰å§”æ´¾ç±»å·¥å…·ï¼ˆ`delegateToFileAgent`ã€`delegateToTranslateAgent`ï¼‰ï¼›æ–‡ä»¶ Worker åªæœ‰ `runSafeShell`ï¼›ç¿»è¯‘ Worker æœ‰ `translate`ã€`polish`ã€`summarize`ã€‚æ¨¡å‹åœ¨æ¯æ¬¡è°ƒç”¨æ—¶åªèƒ½â€œçœ‹åˆ°â€å½“å‰ Agent çš„é‚£å¥—å·¥å…·ï¼Œä»è€Œè¢«çº¦æŸåœ¨å¯¹åº”èƒ½åŠ›èŒƒå›´å†…ã€‚
- **ä¸åŒè¾“å…¥å½¢æ€**ï¼šå§”æ´¾æ—¶ä¼ å…¥çš„æ˜¯â€œå­ä»»åŠ¡æè¿°â€ï¼ˆquery/contentï¼‰ï¼Œå¯¹ Worker è€Œè¨€å°±æ˜¯ä¸€æ¡ç”¨æˆ·æ¶ˆæ¯ï¼ŒWorker ä¸éœ€è¦çŸ¥é“è‡ªå·±åœ¨è¢«å§”æ´¾ï¼Œåªéœ€æŒ‰è‡ªå·±çš„ system + tools å®Œæˆè¿™æ¡è¯·æ±‚ã€‚

è¿™æ ·åšçš„æ„ä¹‰åœ¨äºï¼š**ç”¨â€œå®šä¹‰â€ï¼ˆprompt + toolsï¼‰åŒºåˆ†è§’è‰²ä¸èƒ½åŠ›ï¼Œè€Œä¸æ˜¯ç”¨ä¸åŒæ¨¡å‹**ã€‚æˆæœ¬ä½ã€æ˜“æ‰©å±•ï¼šåŠ ä¸€ä¸ªæ–° Agent åªéœ€åŠ ä¸€å¥— system + tools + å§”æ´¾ schemaï¼Œæ— éœ€æ–°æ¨¡å‹æˆ–å¾®è°ƒã€‚

### 4.2 System message åœ¨æœ¬æ¨¡å¼ä¸­çš„ä½œç”¨

åœ¨æœ¬ Agent æ¨¡å¼ä¸­ï¼Œ**system message æ˜¯åŒºåˆ†â€œè¿™æ˜¯è°â€çš„ä¸»è¦æ‰‹æ®µ**ï¼Œå’Œå·¥å…·ä¸€èµ·å†³å®šå½“å‰è¿™ä¸€æ­¥çš„æ¨¡å‹è¡Œä¸ºï¼š

1. **è§’è‰²ä¸è¾¹ç•Œ**ï¼šæ˜ç¡®â€œä½ æ˜¯åè°ƒè€… / æ–‡ä»¶åŠ©æ‰‹ / ç¿»è¯‘åŠ©æ‰‹â€ï¼Œæ¨¡å‹æ‰ä¼šåšè·¯ç”±ã€åš Shellã€åšç¿»è¯‘ï¼Œè€Œä¸æ˜¯è¶Šç•Œå»å¹²åˆ«çš„ã€‚
2. **ç»“æŸæ¡ä»¶**ï¼šæœ¬ä»“åº“çº¦å®šæ¯ä¸ª Worker åœ¨å›å¤ç»“å°¾åŠ ä¸Š `[STOP]`ï¼Œè¿™ä¸€çº¦å®šå†™åœ¨ system é‡Œï¼Œæ¨¡å‹æ‰ä¼šåœ¨å®Œæˆä»»åŠ¡åä¸»åŠ¨ç»“æŸå¾ªç¯ï¼ŒæŠŠæ§åˆ¶æƒäº¤å›åè°ƒè€…ã€‚
3. **å®‰å…¨ä¸çº¦æŸ**ï¼šä¾‹å¦‚æ–‡ä»¶ Agent çš„ system é‡Œå†™æ˜â€œä¸¥ç¦æ‰§è¡Œåˆ é™¤æ“ä½œâ€ï¼Œæ¨¡å‹åœ¨åªçœ‹åˆ° `runSafeShell` æ—¶ä»ä¼šæ‹’ç» rm/del ç±»è¯·æ±‚ï¼Œå› ä¸ºèº«ä»½å’Œè¾¹ç•Œå·²åœ¨ system é‡Œå®šå¥½ã€‚

å› æ­¤ï¼š**åŒä¸€æ¨¡å‹ + ä¸åŒ system message + ä¸åŒ tools = å¤šä¸ªâ€œè™šæ‹Ÿâ€çš„ä¸“å®¶ Agent**ï¼Œæ— éœ€ä¸ºæ¯ä¸ªä¸“å®¶å•ç‹¬è®­ç»ƒæ¨¡å‹ã€‚

### 4.3 ä¼˜åŠ¿

- **èŒè´£æ¸…æ™°**ï¼šåè°ƒè€…è´Ÿè´£è·¯ç”±ä¸æ±‡æ€»ï¼ŒWorker åªå…³å¿ƒè‡ªå·±çš„é¢†åŸŸå’Œå·¥å…·ï¼Œä¾¿äºç»´æŠ¤å’Œæ‰©å±•ã€‚
- **å¯å¤ç”¨**ï¼šåŒä¸€ Workerï¼ˆå¦‚æ–‡ä»¶ Agentï¼‰å¯è¢«ä¸åŒå…¥å£ã€ä¸åŒåè°ƒè€…å¤ç”¨ã€‚
- **æ˜“æ‰©å±•**ï¼šæ–°å¢ä¸€ç±»ä»»åŠ¡æ—¶ï¼Œå¢åŠ ä¸€ä¸ª Agent å®šä¹‰ï¼ˆsystem + tools + å§”æ´¾ schemaï¼‰å³å¯ï¼Œä»ç”¨åŒä¸€æ¨¡å‹ã€‚

### 4.4 åŠ£åŠ¿

- **å»¶è¿Ÿä¸æˆæœ¬**ï¼šä¸€æ¬¡ç”¨æˆ·è¯·æ±‚å¯èƒ½è§¦å‘å¤šè½®åè°ƒè€… â†” Worker çš„è°ƒç”¨ï¼ŒToken ä¸å»¶è¿Ÿéƒ½ä¼šå¢åŠ ã€‚
- **åè°ƒè€…èƒ½åŠ›**ï¼šå§”æ´¾æ˜¯å¦åˆç†ä¾èµ–åè°ƒè€…çš„æ„å›¾è¯†åˆ«ä¸å·¥å…·é€‰æ‹©èƒ½åŠ›ã€‚

## 5. è¿è¡Œæ–¹å¼

ç¯å¢ƒè¦æ±‚ï¼šé¡¹ç›®æ ¹ç›®å½•æˆ–æœ¬ç›®å½•ä¸‹æœ‰ `.env`ï¼Œä¸”é…ç½® `DEEPSEEK_API_KEY`ã€‚

```bash
cd "L11 æ„å»ºå¤š Agents å·¥ä½œæµ"
npm install
npm run dev
```

åœ¨äº¤äº’å¼å‘½ä»¤è¡Œä¸­è¾“å…¥è‡ªç„¶è¯­è¨€å³å¯ï¼Œä¾‹å¦‚ï¼š

- â€œçœ‹ä¸€ä¸‹æˆ‘ ~/downloads é‡Œæœ‰å¤šå°‘å…³äºè®¾è®¡çš„æ–‡ä»¶ï¼Œæ•´ç†å‡ºæ¥ä¹‹åç¿»è¯‘æˆè‹±æ–‡ï¼Œå†™åˆ° ~/downloads/output.mdã€‚â€
- â€œæŠŠè¿™æ®µä¸­æ–‡ç¿»è¯‘æˆè‹±æ–‡å¹¶æ¶¦è‰²ä¸€ä¸‹ã€‚â€
- â€œåˆ—å‡ºå½“å‰ç›®å½•ä¸‹çš„ .md æ–‡ä»¶ï¼Œå¹¶ç»™æ¯ä¸ªæ–‡ä»¶åå†™ä¸€å¥è‹±æ–‡æ‘˜è¦ã€‚â€

è¾“å…¥ `exit` é€€å‡ºã€‚

## 6. Demo è¾“å‡º

ä»¥ä¸‹æ˜¯ä¸€æ¬¡å®Œæ•´çš„å¤š Agent åä½œç¤ºä¾‹ï¼šç”¨æˆ·è¦æ±‚æŸ¥çœ‹ `~/downloads` ä¸­ä¸ã€Œè®¾è®¡ã€ç›¸å…³çš„æ–‡ä»¶ã€æ•´ç†åç¿»è¯‘æˆè‹±æ–‡å¹¶å†™å…¥ `~/downloads/output.md`ã€‚åè°ƒè€…ä¾æ¬¡å§”æ´¾ç»™ file Agentï¼ˆåˆ—æ–‡ä»¶ï¼‰ã€translate Agentï¼ˆç¿»è¯‘ï¼‰ã€å†å§”æ´¾ç»™ file Agentï¼ˆå†™æ–‡ä»¶ï¼‰ã€‚

```text
â¯ npm run dev

> 11-multi-agents-workflow@1.0.0 dev
> ts-node src/index.ts

[dotenv@17.2.3] injecting env (1) from ../.env -- tip: ğŸ”‘ add access controls to secrets: https://dotenvx.com/ops
--- å¤š Agents å·¥ä½œæµï¼ˆCoordinator + Workerï¼‰---

User: çœ‹ä¸€ä¸‹æˆ‘ ~/downloads æ–‡ä»¶å¤¹é‡Œæœ‰å¤šå°‘å…³äºè®¾è®¡çš„æ–‡ä»¶ï¼Œæ•´ç†å‡ºæ¥ä¹‹åç¿»è¯‘æˆè‹±æ–‡ï¼Œå¹¶ä¸”å†™åˆ°æˆ‘ ~/downloads/output.md çš„æ–‡ä»¶é‡Œ

AI: æˆ‘æ¥å¸®æ‚¨å®Œæˆè¿™ä¸ªä»»åŠ¡ã€‚é¦–å…ˆï¼Œæˆ‘éœ€è¦æŸ¥çœ‹æ‚¨çš„ ~/downloads æ–‡ä»¶å¤¹ï¼Œç„¶åæ•´ç†å‡ºå…³äºè®¾è®¡çš„æ–‡ä»¶ï¼Œæ¥ç€ç¿»è¯‘æˆè‹±æ–‡ï¼Œæœ€åå†™å…¥åˆ° output.md æ–‡ä»¶ä¸­ã€‚
...
Tool: delegateToFileAgent({"query": "åˆ—å‡º ~/downloads æ–‡ä»¶å¤¹ä¸­çš„æ‰€æœ‰æ–‡ä»¶ï¼Œå¹¶ç­›é€‰å‡ºåŒ…å«\"è®¾è®¡\"æˆ–\"design\"ç›¸å…³å…³é”®è¯çš„æ–‡ä»¶"})

        [file Agent]

        AI: æˆ‘æ¥å¸®æ‚¨åˆ—å‡º ~/downloads æ–‡ä»¶å¤¹ä¸­çš„æ–‡ä»¶ï¼Œå¹¶ç­›é€‰å‡ºåŒ…å«"è®¾è®¡"æˆ–"design"ç›¸å…³å…³é”®è¯çš„æ–‡ä»¶ã€‚
        Tool: runSafeShell({"command": "ls -la ~/downloads"})
          â†’ total 7662024 drwxr-xr-x     3 aqiu  staff         96 Sep 15  2022 $RECYCLE.BIN drwx------@ 1420 ...

        AI: ç°åœ¨æˆ‘æ¥ç­›é€‰å‡ºåŒ…å«"è®¾è®¡"æˆ–"design"ç›¸å…³å…³é”®è¯çš„æ–‡ä»¶ï¼š
        Tool: runSafeShell({"command": "ls -la ~/downloads | grep -i \"è®¾è®¡\\|design\""})
          â†’ -rw-r--r--@    1 aqiu  staff     821250 May 12  2025 2025.05.12_æˆéƒ½æ–‡æ—…é›†å›¢ä¸»è§†è§‰ç”»é¢è®¾è®¡æœåŠ¡åˆåŒ.pages drwxr-xr-...

        AI: è®©æˆ‘å†ä»”ç»†æ£€æŸ¥ä¸€ä¸‹ï¼Œçœ‹çœ‹æ˜¯å¦æœ‰æ›´å¤šåŒ…å«"è®¾è®¡"æˆ–"design"å…³é”®è¯çš„æ–‡ä»¶ï¼ˆåŒ…æ‹¬æ–‡ä»¶åä¸­çš„å¤§å°å†™å˜ä½“ï¼‰ï¼š
        Tool: runSafeShell({"command": "ls -la ~/downloads | grep -i -E \"è®¾è®¡|design|Design|DESIGN\""})
          â†’ -rw-r--r--@    1 aqiu  staff     821250 May 12  2025 2025.05.12_æˆéƒ½æ–‡æ—…é›†å›¢ä¸»è§†è§‰ç”»é¢è®¾è®¡æœåŠ¡åˆåŒ.pages drwxr-xr-...

        AI: ç°åœ¨è®©æˆ‘æŸ¥çœ‹ä¸€ä¸‹è¿™äº›æ–‡ä»¶çš„è¯¦ç»†ä¿¡æ¯ï¼ŒåŒ…æ‹¬æ–‡ä»¶å¤§å°å’Œä¿®æ”¹æ—¶é—´ï¼š
        Tool: runSafeShell({"command": "ls -lh ~/downloads | grep -i -E \"è®¾è®¡|design|Design|DESIGN\""})
          â†’ -rw-r--r--@    1 aqiu  staff   802K May 12  2025 2025.05.12_æˆéƒ½æ–‡æ—…é›†å›¢ä¸»è§†è§‰ç”»é¢è®¾è®¡æœåŠ¡åˆåŒ.pages drwxr-xr-@  ...

        AI: æ ¹æ®æœç´¢ç»“æœï¼Œæˆ‘ä¸ºæ‚¨åˆ—å‡ºäº† ~/downloads æ–‡ä»¶å¤¹ä¸­æ‰€æœ‰åŒ…å«"è®¾è®¡"æˆ–"design"ç›¸å…³å…³é”®è¯çš„æ–‡ä»¶ã€‚ä»¥ä¸‹æ˜¯ç­›é€‰ç»“æœï¼š

        ## åŒ…å«"è®¾è®¡"æˆ–"des...

AI: ç°åœ¨æˆ‘å·²ç»æ‰¾åˆ°äº†æ‰€æœ‰å…³äºè®¾è®¡çš„æ–‡ä»¶ã€‚æ¥ä¸‹æ¥ï¼Œæˆ‘éœ€è¦å°†è¿™äº›æ–‡ä»¶ä¿¡æ¯æ•´ç†æˆè‹±æ–‡ç‰ˆæœ¬ï¼š
Tool: delegateToTranslateAgent({"content": "è¯·å°†ä»¥ä¸‹å…³äºè®¾è®¡æ–‡ä»¶çš„ä¿¡æ¯ç¿»è¯‘æˆè‹±æ–‡ï¼š\n\n## åŒ…å«\"è®¾è®¡\"æˆ–\"design\"å…³é”®è¯çš„æ–‡ä»¶åˆ—è¡¨ï¼š\n\n### 1....)

        [translate Agent]

        AI: æˆ‘æ¥å¸®æ‚¨å°†è¿™æ®µå…³äºè®¾è®¡æ–‡ä»¶çš„ä¿¡æ¯ç¿»è¯‘æˆè‹±æ–‡ã€‚
        Tool: translate({"text": "## åŒ…å«\"è®¾è®¡\"æˆ–\"design\"å…³é”®è¯çš„æ–‡ä»¶åˆ—è¡¨ï¼š\n\n### 1. è®¾è®¡ç›¸å…³æ–‡ä»¶ï¼š\n1. **2025.05.12_...)
          â†’ [Translation] ## åŒ…å«"è®¾è®¡"æˆ–"design"å…³é”®è¯çš„æ–‡ä»¶åˆ—è¡¨ï¼š  ### 1. è®¾è®¡ç›¸å…³æ–‡ä»¶ï¼š 1. **2025.05.12_æˆéƒ½æ–‡æ—…é›†å›¢ä¸»è§†è§‰ç”»é¢è®¾è®¡æœåŠ¡åˆåŒ.pages...

        AI: ## List of files containing the keywords "è®¾è®¡" or "design":

        ### 1. Files related...
>
AI: å¾ˆå¥½ï¼ç°åœ¨æˆ‘éœ€è¦å°†è¿™ä¸ªè‹±æ–‡ç‰ˆæœ¬å†™å…¥åˆ° ~/downloads/output.md æ–‡ä»¶ä¸­ï¼š
Tool: delegateToFileAgent({"query": "å°†ä»¥ä¸‹å†…å®¹å†™å…¥åˆ° ~/downloads/output.md æ–‡ä»¶ä¸­ï¼š\n\n# Design Files in Downloads...)

        [file Agent]

        AI: æˆ‘å°†æŠŠæ‚¨æä¾›çš„å†…å®¹å†™å…¥åˆ° ~/downloads/output.md æ–‡ä»¶ä¸­ã€‚
        Tool: runSafeShell({"command": "echo \"# Design Files in Downloads Folder\n\n## List of files co...)
          â†’ (æ— è¾“å‡º)

        AI: å†…å®¹å·²æˆåŠŸå†™å…¥åˆ° ~/downloads/output.md æ–‡ä»¶ä¸­ã€‚è®©æˆ‘éªŒè¯ä¸€ä¸‹æ–‡ä»¶æ˜¯å¦åˆ›å»ºæˆåŠŸï¼š
        Tool: runSafeShell({"command": "ls -la ~/downloads/output.md"})
          â†’ -rw-r--r--@ 1 aqiu  staff  1452 Jan 30 00:02 /Users/aqiu/downloads/output.md

        AI: æ–‡ä»¶å·²æˆåŠŸåˆ›å»ºã€‚è®©æˆ‘å†æŸ¥çœ‹ä¸€ä¸‹æ–‡ä»¶å†…å®¹çš„å‰å‡ è¡Œä»¥ç¡®è®¤å†™å…¥æ­£ç¡®ï¼š
        Tool: runSafeShell({"command": "head -20 ~/downloads/output.md"})
          â†’ # Design Files in Downloads Folder  ## List of files containing the keywords "è®¾è®¡" or "design":  #...

        AI: å®Œç¾ï¼æ‚¨æä¾›çš„å…³äºåŒ…å«"è®¾è®¡"æˆ–"design"å…³é”®è¯çš„æ–‡ä»¶åˆ—è¡¨å·²æˆåŠŸå†™å…¥åˆ° ~/downloads/output.md æ–‡ä»¶ä¸­ã€‚æ–‡ä»¶å¤§å°ä¸º1452å­—èŠ‚ï¼ŒåŒ…å«äº†...

AI: å®Œç¾ï¼æˆ‘å·²ç»å®Œæˆäº†æ‚¨çš„æ‰€æœ‰è¦æ±‚ï¼š

1. **æŸ¥çœ‹äº† ~/downloads æ–‡ä»¶å¤¹**ï¼šæ‰¾åˆ°äº†12ä¸ªå…³äºè®¾è®¡çš„æ–‡ä»¶/ç›®å½•
2. **æ•´ç†å‡ºäº†è®¾è®¡æ–‡ä»¶**ï¼šåŒ…æ‹¬...

User:
```

## 7. ä»£ç ç»“æ„é€Ÿè§ˆ

- **`src/index.ts`**ï¼šå…¥å£ä¸ä¸»å¾ªç¯ã€‚åè°ƒè€… system promptã€`runMultiAgentWorkflow`ã€`runAgentLoop`ï¼›å§”æ´¾æ—¶è°ƒç”¨ `runWorkerAgent(workerType, userQuery)`ï¼ŒWorker ä½¿ç”¨å„è‡ª `agent.systemPrompt` + `agent.workerTools` å†è°ƒåŒä¸€æ¨¡å‹ã€‚
- **`src/agents/registry.ts`**ï¼šæ³¨å†Œæ‰€æœ‰ Agentï¼ˆfileã€translateï¼‰ï¼Œå¯¼å‡º `coordinatorTools`ã€`getAgentById`ã€`createCoordinatorToolHandler`ã€‚
- **`src/agents/file.ts`** / **`src/agents/translate.ts`**ï¼šå„ Agent çš„â€œå®šä¹‰â€ï¼š`systemPrompt`ã€`workerTools`ã€`delegateSchema`ï¼ˆå§”æ´¾å·¥å…·åä¸å‚æ•°ï¼‰ã€‚
- **`src/tools/`**ï¼šåŸå§‹å·¥å…·å®ç°ï¼ˆå¦‚ `runSafeShell`ã€`translate`ï¼‰ï¼Œç”± Worker ä½¿ç”¨ï¼›åè°ƒè€…åªé€šè¿‡å§”æ´¾å·¥å…·é—´æ¥è°ƒç”¨ã€‚
- **é€šç”¨å¾ªç¯**ï¼š`runAgentLoop(messages, tools, handleToolCalls)` ä¸ L09 ä¸€è‡´ï¼Œé€šè¿‡ä¼ å…¥ä¸åŒ `tools` å’Œ `handleToolCalls` å®ç°åè°ƒè€…ä¸å¤š Worker çš„åŒºåˆ†ã€‚
